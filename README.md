# 网易云音乐用户标签服务 API 文档

## 目录

- [概述](#概述)
- [通用规范](#通用规范)
  - [基础URL](#基础url)
  - [认证方式](#认证方式)
  - [请求格式](#请求格式)
  - [响应格式](#响应格式)
  - [状态码说明](#状态码说明)
- [API端点详细说明](#api端点详细说明)
  - [1. 健康检查](#1-健康检查)
  - [2. 获取用户标签](#2-获取用户标签)
  - [3. 添加用户标签](#3-添加用户标签)
  - [4. 删除用户标签](#4-删除用户标签)
  - [5. 查找拥有特定标签的用户](#5-查找拥有特定标签的用户)
  - [6. 获取所有标签](#6-获取所有标签)
- [错误处理](#错误处理)
- [附录](#附录)
  - [示例代码](#示例代码)

## 概述

本文档详细描述了网易云音乐用户标签服务的REST API接口。该服务提供用户标签的添加、查询和删除功能，支持基于标签查找用户等操作。

## 通用规范

### 基础URL

所有API请求的基础URL如下：

```
http://localhost:8000
```

在生产环境中，请将此URL替换为实际的服务地址。

### 认证方式

当前版本API不要求认证。未来版本可能会添加API密钥或OAuth认证。

### 请求格式

- **Content-Type**: 除非特别说明，所有请求和响应均使用JSON格式，HTTP头需设置：
  ```
  Content-Type: application/json
  Accept: application/json
  ```

- **字符编码**: 所有API均使用UTF-8字符编码

### 响应格式

所有API响应（除了特定的错误情况）均使用统一的JSON格式：

```json
{
  "status": "成功|错误",
  "message": "描述性消息",
  "data": {
    // 响应数据对象（可选）
  }
}
```

字段说明：
- `status`: 请求处理状态，值为"成功"或"错误"
- `message`: 对状态的描述性说明
- `data`: 包含响应数据的对象，根据端点不同而变化，部分响应可能没有此字段

### 状态码说明

| 状态码 | 说明 | 
|--------|------|
| 200 | 成功 - 请求已成功处理 | 
| 201 | 已创建 - 资源创建成功 | 
| 400 | 错误请求 - 请求参数错误或缺失 | 
| 404 | 未找到 - 请求的资源不存在 | 
| 422 | 无法处理的实体 - 请求格式正确但语义错误 | 
| 500 | 服务器内部错误 - 处理请求时发生意外错误 | 

## API端点详细说明

### 1. 健康检查

#### 请求

```
GET /ping
```

#### 请求头

无特殊要求

#### 请求体

无

#### 响应

**成功响应 (200 OK)**

```json
{
  "status": "成功",
  "message": "用户标签服务正在运行"
}
```

#### 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 - 服务正常运行 |
| 500 | 服务器内部错误 - 服务异常 |

---

### 2. 获取用户标签

获取指定用户的所有标签。

#### 请求

```
GET /users/{user_id}/tags
```

#### 路径参数

| 参数 | 类型 | 必需 | 描述 |
|------|------|------|------|
| user_id | string | 是 | 用户的唯一标识符 |

#### 请求头

无特殊要求

#### 请求体

无

#### 响应

**成功响应 - 用户有标签 (200 OK)**

```json
{
  "status": "成功",
  "message": "成功获取标签",
  "data": {
    "user_id": "music_lover_123",
    "tags": ["摇滚乐迷", "夜猫子", "ACG爱好者"]
  }
}
```

**成功响应 - 用户无标签 (200 OK)**

```json
{
  "status": "成功",
  "message": "未找到该用户的标签",
  "data": {
    "user_id": "new_user_456",
    "tags": []
  }
}
```

#### 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 - 返回用户标签或空列表 |
| 500 | 服务器内部错误 - 处理请求时发生错误 |

---

### 3. 添加用户标签

为指定用户添加一个或多个标签。

#### 请求

```
POST /users/{user_id}/tags
```

#### 路径参数

| 参数 | 类型 | 必需 | 描述 |
|------|------|------|------|
| user_id | string | 是 | 用户的唯一标识符 |

#### 请求头

| 头部 | 值 | 必需 | 描述 |
|------|------|------|------|
| Content-Type | application/json | 是 | 指定请求体格式为JSON |

#### 请求体

```json
{
  "tags": ["摇滚乐迷", "夜猫子", "ACG爱好者"]
}
```

| 字段 | 类型 | 必需 | 描述 |
|------|------|------|------|
| tags | string[] | 是 | 要添加的标签列表，不能为空 |

#### 响应

**成功响应 (201 Created)**

```json
{
  "status": "成功",
  "message": "标签添加成功",
  "data": {
    "user_id": "music_lover_123",
    "tags": ["摇滚乐迷", "夜猫子", "ACG爱好者"]
  }
}
```

**错误响应 (400 Bad Request)**

```json
{
  "detail": "请至少提供一个标签"
}
```

#### 状态码

| 状态码 | 说明 |
|--------|------|
| 201 | 已创建 - 标签添加成功 |
| 400 | 错误请求 - 标签列表为空或格式错误 |
| 422 | 无法处理的实体 - 请求格式错误 |
| 500 | 服务器内部错误 - 处理请求时发生错误 |

---

### 4. 删除用户标签

删除指定用户的特定标签。

#### 请求

```
DELETE /users/{user_id}/tags/{tag}
```

#### 路径参数

| 参数 | 类型 | 必需 | 描述 |
|------|------|------|------|
| user_id | string | 是 | 用户的唯一标识符 |
| tag | string | 是 | 要删除的标签，需URL编码 |

#### 请求头

无特殊要求

#### 请求体

无

#### 响应

**成功响应 (200 OK)**

```json
{
  "status": "成功",
  "message": "成功删除标签 '夜猫子'",
  "data": {
    "user_id": "music_lover_123",
    "removed_tag": "夜猫子"
  }
}
```

**错误响应 (404 Not Found)**

```json
{
  "detail": "用户 'music_lover_123' 没有标签 '古典乐'"
}
```

#### 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 - 标签删除成功 |
| 404 | 未找到 - 用户不存在或没有指定标签 |
| 500 | 服务器内部错误 - 处理请求时发生错误 |

---

### 5. 查找拥有特定标签的用户

获取所有拥有指定标签的用户列表。

#### 请求

```
GET /tags/{tag}/users
```

#### 路径参数

| 参数 | 类型 | 必需 | 描述 |
|------|------|------|------|
| tag | string | 是 | 要查找的标签，需URL编码 |

#### 请求头

无特殊要求

#### 请求体

无

#### 响应

**成功响应 (200 OK)**

```json
{
  "status": "成功",
  "message": "成功获取拥有标签 '摇滚乐迷' 的用户",
  "data": {
    "tag": "摇滚乐迷",
    "users": ["music_lover_123", "rock_fan_456", "guitarist_789"]
  }
}
```

**成功响应 - 无用户有该标签 (200 OK)**

```json
{
  "status": "成功",
  "message": "成功获取拥有标签 '古典乐' 的用户",
  "data": {
    "tag": "古典乐",
    "users": []
  }
}
```

#### 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 - 返回用户列表或空列表 |
| 500 | 服务器内部错误 - 处理请求时发生错误 |

---

### 6. 获取所有标签

获取系统中存在的所有标签。

#### 请求

```
GET /tags
```

#### 请求头

无特殊要求

#### 请求体

无

#### 响应

**成功响应 (200 OK)**

```json
{
  "status": "成功",
  "message": "成功获取所有标签",
  "data": {
    "tags": ["摇滚乐迷", "夜猫子", "ACG爱好者", "古典乐迷", "电子乐迷", "早起族"]
  }
}
```

**成功响应 - 无标签 (200 OK)**

```json
{
  "status": "成功",
  "message": "成功获取所有标签",
  "data": {
    "tags": []
  }
}
```

#### 状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 - 返回标签列表或空列表 |
| 500 | 服务器内部错误 - 处理请求时发生错误 |

## 错误处理

当API发生错误时，将返回相应的HTTP状态码和JSON格式的错误详情。标准错误响应格式如下：

```json
{
  "detail": "错误描述"
}
```

常见错误场景：

1. **请求参数缺失或无效**
   ```json
   {
     "detail": "请至少提供一个标签"
   }
   ```

2. **请求的资源不存在**
   ```json
   {
     "detail": "用户 'user123' 没有标签 '古典乐'"
   }
   ```

3. **服务器内部错误**
   ```json
   {
     "detail": "内部服务器错误"
   }
   ```



